<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hq.ecmp.mscore.mapper.CollectionQuittanceInfoMapper">


    <insert id="add" parameterType="com.hq.ecmp.mscore.domain.ReckoningInfo">
        insert into collection_quittance_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="car_group_id != null ">,</if>
            <if test="company_id != null ">,</if>
            <if test="begin_date != null ">,</if>
            <if test="end_date != null ">,</if>
            <if test="collection_end_time != null ">,</if>
            <if test="state != null ">,</if>
            <if test="applicant != null ">,</if>
            <if test="verifier != null ">,</if>
            <if test="create_by != null ">,</if>
            <if test="create_time != null ">,</if>
            <if test="update_by != null ">,</if>
            <if test="update_time != null ">,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test=" != null ">#{carGroupId},</if>
            <if test=" != null ">#{companyId},</if>
            <if test=" != null ">#{beginDate},</if>
            <if test=" != null ">#{endDate},</if>
            <if test=" != null ">#{collectionEndTime},</if>
            <if test=" != null ">#{state},</if>
            <if test=" != null ">#{applicant},</if>
            <if test=" != null ">#{verifier},</if>
            <if test=" != null ">#{createBy},</if>
            <if test=" != null ">#{createTime},</if>
            <if test=" != null ">#{updateBy},</if>
            <if test=" != null ">#{updateTime},</if>
        </trim>
    </insert>

    <update id="updateReckoningStatus" parameterType="com.hq.ecmp.mscore.dto.ReckoningDto">
        update
          collection_quittance_info
        <trim prefix="SET" suffixOverrides=",">
            <if test="status != null ">state = #{status},</if>
            <if test="verifier != null ">verifier = #{verifier},</if>
        </trim>
        where
          company_id = #{companyId}
    </update>

    <select id="getOrdinaryUserList" parameterType="com.hq.ecmp.mscore.dto.lease.LeaseSettlementDto" resultType="com.hq.ecmp.mscore.dto.lease.LeaseSettlementDto">
       select
            cqi.collection_id collectionId,
            eo.dept_name deptName,
            cqi.begin_date beginData,
            cqi.end_date endData,
		    cqi.state state,
		    cqi.verifier verifier,
            cqi.create_time createTime
       from collection_quittance_info cqi
       left join  ecmp_org eo ON eo.company_id = cqi.company_id
       where cqi.company_id=#{companyId}
        <if test="deptName!=null and deptName!=''" >
            and  eo.dept_name  like concat('%',#{deptName},'%')
        </if>
        <if test="state!=null and state!=''" >
            and  cqi.state =#{state}
        </if>
    </select>
    <update id="ordinaryUserConfirmCost" parameterType="com.hq.ecmp.mscore.dto.lease.LeaseSettlementDto">
         update collection_quittance_info set state=#{state},create_by=#{createBy} where collection_id=#{collectionId}
    </update>
    <select id="getPayeeInfo" resultType="java.util.Map" parameterType="java.lang.Long">
        SELECT
            g.car_group_name carGroupName,
            g.telephone telephone,        --#客服电话：租赁公司电话
            g.account_name accountName,  --#租赁公司开户名称
            g.bank_name bankName,        --#开户行
            g.bank_account bankAccount,  --#银行账号
            o.dept_name deptName         --#所选用车单位
        FROM
            car_group_info g
            LEFT JOIN ecmp_org o ON g.company_id = o.company_id
        WHERE
            g.company_id = #{companyId}
    </select>
</mapper>
